<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>خوشحال فیبرک - ایڈمن</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body { background: #f8f9fa; padding: 20px; }
        .admin-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .suit-list-img { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-dark">STOCK ADMIN (اسٹاک مینجمنٹ)</h2>
        <a href="index.html" class="btn btn-dark">BACK TO SALES (سیلز پیج)</a>
    </div>

    <div class="row g-4">
        <!-- سوٹ اپلوڈ اور ایڈٹ فارم -->
        <div class="col-md-4">
            <div class="admin-card">
                <h5 id="formTitle" class="fw-bold mb-3 text-primary">نیا سوٹ شامل کریں</h5>
                <input type="hidden" id="editId">
                <input type="text" id="pName" class="form-control mb-2" placeholder="سوٹ کا نام">
                <input type="number" id="pPrice" class="form-control mb-2" placeholder="قیمت (Rs)">
                <input type="number" id="pStock" class="form-control mb-2" placeholder="اسٹاک (کتنے سوٹ ہیں)">
                <input type="text" id="pImg" class="form-control mb-3" placeholder="تصویر کا لنک (Image URL)">
                <button id="saveBtn" class="btn btn-primary w-100 fw-bold" onclick="saveProduct()">محفوظ کریں (SAVE)</button>
                <button id="cancelBtn" class="btn btn-light w-100 mt-2 d-none" onclick="resetForm()">کینسل (CANCEL)</button>
            </div>
        </div>

        <!-- اسٹاک کی لسٹ -->
        <div class="col-md-8">
            <div class="admin-card">
                <h5 class="fw-bold mb-3">موجودہ اسٹاک لسٹ</h5>
                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>تصویر</th>
                                <th>نام</th>
                                <th>قیمت</th>
                                <th>اسٹاک</th>
                                <th>عمل (Actions)</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryList">
                            <!-- لسٹ یہاں لوڈ ہوگی -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = JSON.parse(__firebase_config);
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colRef = collection(db, "artifacts", "khushal-pos", "public", "data", "suits");

    // لسٹ دکھانا
    onSnapshot(colRef, (snapshot) => {
        const list = document.getElementById('inventoryList');
        list.innerHTML = '';
        snapshot.forEach(doc => {
            const data = doc.data();
            list.innerHTML += `
                <tr>
                    <td><img src="${data.img}" class="suit-list-img" onerror="this.src='https://via.placeholder.com/50'"></td>
                    <td><b>${data.name}</b></td>
                    <td>Rs. ${data.price}</td>
                    <td>${data.stock}</td>
                    <td>
                        <button class="btn btn-sm btn-info text-white me-1" onclick="startEdit('${doc.id}', '${data.name}', ${data.price}, ${data.stock}, '${data.img}')">
                            <i class="bi bi-pencil"></i> ایڈٹ
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteItem('${doc.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>`;
        });
    });

    // محفوظ یا اپ ڈیٹ کرنا
    window.saveProduct = async () => {
        const id = document.getElementById('editId').value;
        const data = {
            name: document.getElementById('pName').value,
            price: Number(document.getElementById('pPrice').value),
            stock: Number(document.getElementById('pStock').value),
            img: document.getElementById('pImg').value
        };

        if (!data.name || !data.price) return alert("براہ کرم تمام معلومات لکھیں!");

        if (id) {
            await updateDoc(doc(db, "artifacts", "khushal-pos", "public", "data", "suits", id), data);
            alert("سوٹ اپ ڈیٹ ہو گیا!");
        } else {
            await addDoc(colRef, data);
            alert("نیا سوٹ شامل ہو گیا!");
        }
        resetForm();
    };

    // ایڈٹ شروع کرنا
    window.startEdit = (id, name, price, stock, img) => {
        document.getElementById('editId').value = id;
        document.getElementById('pName').value = name;
        document.getElementById('pPrice').value = price;
        document.getElementById('pStock').value = stock;
        document.getElementById('pImg').value = img;
        
        document.getElementById('formTitle').innerText = "سوٹ کی معلومات بدلیں (EDITING)";
        document.getElementById('saveBtn').innerText = "اپ ڈیٹ کریں (UPDATE)";
        document.getElementById('cancelBtn').classList.remove('d-none');
    };

    window.resetForm = () => {
        document.getElementById('editId').value = '';
        document.getElementById('pName').value = '';
        document.getElementById('pPrice').value = '';
        document.getElementById('pStock').value = '';
        document.getElementById('pImg').value = '';
        document.getElementById('formTitle').innerText = "نیا سوٹ شامل کریں";
        document.getElementById('saveBtn').innerText = "محفوظ کریں (SAVE)";
        document.getElementById('cancelBtn').classList.add('d-none');
    };

    window.deleteItem = async (id) => {
        if (confirm("کیا آپ واقعی اسے ڈیلیٹ کرنا چاہتے ہیں؟")) {
            await deleteDoc(doc(db, "artifacts", "khushal-pos", "public", "data", "suits", id));
        }
    };
</script>
</body>
</html>

